<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity WebGL Player | drope-dude</title>

  <!-- Favicon & base styles -->
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">

  <!-- ✅ Ключовий мета-тег для мобільних + вирізів екрану -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <!-- (Не обов’язково, але корисно для iOS при «Add to Home Screen») -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="drope-dude">

  <!-- ✅ Стилі повного заповнення видимого екрану -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* без сторінкового скролу */
      background: #000; /* щоб не миготіли краї */
    }

    /* Контейнер Unity на весь видимий екран */
    #unity-container {
      position: fixed;
      inset: 0;                 /* top:0; right:0; bottom:0; left:0 */
      width: 100%;
      height: 100vh;            /* базово */
      height: -webkit-fill-available; /* iOS Safari fallback для адресного рядка */
    }

    /* Сучасні браузери: динамічний viewport (кращий за 100vh) */
    @supports (height: 100dvh) {
      #unity-container { height: 100dvh; }
    }

    /* Канвас завжди розтягується під контейнер */
    #unity-canvas {
      width: 100%;
      height: 100%;
      touch-action: none;
      -webkit-user-select: none;
    }

    /* Прогрес/футер як у шаблоні Unity — лишаємо */
    #unity-loading-bar, #unity-warning, #unity-footer {
      pointer-events: none; /* не заважають тапам по канвасу */
    }
  </style>
</head>
<body>
<div id="unity-container" class="unity-desktop">
  <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
  <div id="unity-loading-bar">
    <div id="unity-logo"></div>
    <div id="unity-progress-bar-empty">
      <div id="unity-progress-bar-full"></div>
    </div>
  </div>
  <div id="unity-warning"></div>
  <div id="unity-footer">
    <div id="unity-webgl-logo"></div>
    <div id="unity-fullscreen-button"></div>
    <div id="unity-build-title">drope-dude</div>
  </div>
</div>

<script>
  var container        = document.querySelector("#unity-container");
  var canvas           = document.querySelector("#unity-canvas");
  var loadingBar       = document.querySelector("#unity-loading-bar");
  var progressBarFull  = document.querySelector("#unity-progress-bar-full");
  var fullscreenButton = document.querySelector("#unity-fullscreen-button");
  var warningBanner    = document.querySelector("#unity-warning");

  function unityShowBanner(msg, type) {
    function update() {
      warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
    }
    var div = document.createElement('div');
    div.innerHTML = msg;
    warningBanner.appendChild(div);
    if (type === 'error') div.style = 'background:red;padding:10px;';
    else if (type === 'warning') {
      div.style = 'background:yellow;padding:10px;';
      setTimeout(function(){ warningBanner.removeChild(div); update(); }, 5000);
    }
    update();
  }

  var buildUrl  = "Build";
  var loaderUrl = buildUrl + "/drop-dude-web-build.loader.js";
  var config = {
    dataUrl:            buildUrl + "/drop-dude-web-build.data",
    frameworkUrl:       buildUrl + "/drop-dude-web-build.framework.js",
    codeUrl:            buildUrl + "/drop-dude-web-build.wasm",
    streamingAssetsUrl: "StreamingAssets",
    companyName:        "DefaultCompany",
    productName:        "drope-dude",
    productVersion:     "0.1.0",
    showBanner:         unityShowBanner
  };

  /* ✅ Єдина логіка для розтягування: без фіксованих px на десктопі */
  function fitToViewport() {
    if (!container) { return; }
    /* Реальна видима область браузера (враховує адресний рядок iOS) */
    container.style.height = window.innerHeight + 'px';
    container.style.width  = window.innerWidth  + 'px';
  }

  /* Слухаємо зміни розміру та орієнтації */
  window.addEventListener('resize', fitToViewport, { passive: true });
  window.addEventListener('orientationchange', function() {
    setTimeout(fitToViewport, 250); // дати iOS перерахувати висоту
  }, { passive: true });
  fitToViewport();

  /* Не додаємо/не міняємо meta viewport динамічно — вже додали в <head> */

  loadingBar.style.display = "block";
  var script = document.createElement("script");
  script.src = loaderUrl;
  script.onload = function () {
    createUnityInstance(canvas, config, function (progress) {
      progressBarFull.style.width = (progress * 100) + "%";
    }).then(function (unityInstance) {
      window.myUnityInstance = unityInstance; // required by JSLIB
      loadingBar.style.display = "none";
      fullscreenButton.onclick = function () { unityInstance.SetFullscreen(1); };
    }).catch(function (e) { alert(e); });
  };
  document.body.appendChild(script);
</script>
</body>
</html>
